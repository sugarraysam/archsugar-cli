---
os: linux
dist: bionic

stages:
  - test

addons:
  apt:
    packages:
      - make
      - libssl-dev

jobs:
  include:
    - name: Yamllint and Ansible-Lint
      language: python
      python: 3.8
      cache: pip
      script:
        - make pydeps
        - make anslint

    - name: Golangci-Lint
      language: go
      go: 1.14.x
      script:
        - make golint

    # '$ make gotest' requires ansible to be installed
    # sonarcloud requires coverage profile generated by '$ make gotest'
    - name: Gotest and SonarQube
      language: go
      go: 1.14.x
      install:
        - sudo apt-add-repository -y ppa:ansible/ansible
        - sudo apt update
        - sudo apt -y install ansible
      script:
        - make gotest
        - sonar-scanner
      cache:
        directories:
          - $HOME/.sonar/cache
          - $HOME/.cache/go-build
          - $GOPATH/pkg/mod
      addons:
        sonarcloud:
          organization: "sugarraysam"
          token:
            secure: "S7z3VHM37Rbal2fc7cEpTS9JrOkEcu3wrbn8R8HkRGZuUepoolZAU2MtZwPGARpdTnwC7fce3/MMhvAZ79rxJ3syENPqbPVUUzZFYJ//LLN6gIs6TLhuMCe2EaKwnVUWglDy/DCTVNE1Xw2rAKRzqZVFglVAzQA2i0vX8qlKS6DqPcv24Iklcm7SUERnTX77TiiXAZqCFPAub/c81D8CcvZrZTi3Oyn+OFXeJOgsnAmKP5Bi1GnZnirruCZv6xQvIhUz5qTEWwW14uMTcslhAc6yv7AinSanyI7cL7oJ2PTioysyfws/nA4fbPf4xUg4IpfnRufL7Du6rTZ4EydL+sD6mVgfvLYmgxMy2HCT+ndtJGlmIIVO0qeKu2xHsvV7SdxS7HacX7g9x2ZUNBDpVEL/RtdLsi+E0rrK9c6kMtgl311aPiCCBLltYJEJWkd/FIAEhcu3MzkD0RhJA4GCr7ssNCVC8zCD0/zbCiDl+zfCMArMTxA+SZRkiMcCdIBVCOh2bDIbaAH/EY1VdcSSCmHTCf2w50VZ9RLccgf6ODNeBWy61Ig6vTyYKcHoegE4yy6gI8KP3APLE6glAKjQcRNBLJCq0RgEQk4s3P0AA1GzEcZ1eYVBkDwjTS/s7jLSrtkzRMLgwsGs98+x6T4Kv3E4urtx1fb578I068LTMB4="

notifications:
  email:
    recipients:
      - samuel.blaisdowdy@protonmail.com
    on_success: never
    on_failure: always
